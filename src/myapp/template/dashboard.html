{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Sistema de Monitoria{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Dashboard de M√©tricas</h1>
        <p>Vis√£o geral do programa de monitoria</p>
    </div>

    <!-- M√©tricas Principais -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-icon blue">üìä</div>
            </div>
            <div class="metric-value">{{ total_vagas|default:24 }}</div>
            <div class="metric-label">Total de Vagas</div>
            <div class="metric-trend">‚Üë +{{ novas_vagas_mes|default:5 }} este m√™s</div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-icon green">üìù</div>
            </div>
            <div class="metric-value">{{ total_candidaturas|default:156 }}</div>
            <div class="metric-label">Candidaturas</div>
            <div class="metric-trend">‚Üë +{{ candidaturas_mes|default:23 }} este m√™s</div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-icon orange">üë•</div>
            </div>
            <div class="metric-value">{{ monitores_ativos|default:18 }}</div>
            <div class="metric-label">Monitores Ativos</div>
            <div class="metric-trend">‚Üë {{ monitores_novos|default:3 }} novos</div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-icon red">‚è∞</div>
            </div>
            <div class="metric-value">{{ horas_monitoria|default:342 }}</div>
            <div class="metric-label">Horas de Monitoria</div>
            <div class="metric-trend">‚Üë {{ horas_mes|default:78 }}h este m√™s</div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-icon blue">‚úÖ</div>
            </div>
            <div class="metric-value">{{ taxa_aprovacao|default:87 }}%</div>
            <div class="metric-label">Taxa de Aprova√ß√£o</div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-icon green">üéì</div>
            </div>
            <div class="metric-value">{{ alunos_atendidos|default:234 }}</div>
            <div class="metric-label">Alunos Atendidos</div>
            <div class="metric-trend">‚Üë {{ alunos_mes|default:45 }} este m√™s</div>
        </div>
    </div>

    <div class="charts-grid">
        <!-- Charts Section -->
        <div>
            <!-- Presen√ßa dos Alunos (Bar Chart) -->
            <div class="chart-card">
                <div class="chart-header">Presen√ßa dos Alunos</div>
                <div class="chart-wrapper">
                    <canvas id="presencaChart"></canvas>
                </div>
            </div>

            <!-- Distribui√ß√£o por Disciplina (Pie Chart) -->
            <div class="chart-card" style="margin-top: 2rem;">
                <div class="chart-header">Distribui√ß√£o por Disciplina</div>
                <div class="chart-wrapper">
                    <canvas id="disciplinasChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Activity Feed -->
        <div>
            <div class="activity-feed">
                <div class="chart-header">Atividades Recentes</div>
                
                {% if atividades_recentes %}
                    {% for atividade in atividades_recentes %}
                        <div class="activity-item">
                            <p><strong>{{ atividade.descricao }}</strong></p>
                            <p class="activity-time">{{ atividade.tempo }}</p>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="activity-item">
                        <p>Nenhuma atividade recente.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tabela de Monitorias Recentes -->
    {% if monitorias_recentes %}
    <div class="chart-card" style="margin-top: 2rem;">
        <div class="chart-header">üìö Monitorias Realizadas (√öltimas 20)</div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Monitor</th>
                        <th>Disciplina</th>
                        <th>Hor√°rio</th>
                        <th>Horas</th>
                        <th>Alunos</th>
                        <th>Descri√ß√£o</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for monitoria in monitorias_recentes %}
                    <tr>
                        <td>{{ monitoria.data|date:"d/m/Y" }}</td>
                        <td>{{ monitoria.monitor }}</td>
                        <td>
                            <strong>{{ monitoria.codigo_disciplina }}</strong><br>
                            <small>{{ monitoria.disciplina }}</small>
                        </td>
                        <td>{{ monitoria.horario_inicio|time:"H:i" }} - {{ monitoria.horario_fim|time:"H:i" }}</td>
                        <td><span class="badge badge-info">{{ monitoria.horas_trabalhadas }}h</span></td>
                        <td><span class="badge badge-success">{{ monitoria.quantidade_alunos }}</span></td>
                        <td style="max-width: 200px; font-size: 0.85rem;">{{ monitoria.descricao }}</td>
                        <td>
                            <button 
                                class="btn btn-sm btn-gradient-info" 
                                onclick="verDetalhesMonitoria({{ monitoria.id }})"
                                title="Ver detalhes completos"
                            >
                                üëÅÔ∏è Ver
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Status das Vagas -->
    <div class="chart-card">
        <div class="chart-header">Status das Vagas</div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Quantidade</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-success">Aberta</span></td>
                        <td>{{ vagas_abertas|default:15 }}</td>
                        <td>{{ vagas_abertas_percent|default:62 }}%</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-warning">Em An√°lise</span></td>
                        <td>{{ vagas_analise|default:6 }}</td>
                        <td>{{ vagas_analise_percent|default:25 }}%</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-danger">Fechada</span></td>
                        <td>{{ vagas_fechadas|default:3 }}</td>
                        <td>{{ vagas_fechadas_percent|default:13 }}%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Dados JSON para os gr√°ficos -->
<script id="presenca-labels-data" type="application/json">{{ presenca_labels|safe }}</script>
<script id="presenca-data-data" type="application/json">{{ presenca_data|safe }}</script>
<script id="disciplinas-labels-data" type="application/json">{{ disciplinas_labels|safe }}</script>
<script id="disciplinas-data-data" type="application/json">{{ disciplinas_data|safe }}</script>

<!-- Bibliotecas de gr√°ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}
